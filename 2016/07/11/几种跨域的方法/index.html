<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="author" content="hunnble,hante_hunter@163.com"><title>几种跨域的方法 · 北方公园</title><meta name="description" content="谈到前端肯定少不了Ajax,谈到Ajax肯定少不了跨域。诗兴大发的我很想说一句，哦，跨域，你就像毒蛇一样，美丽而又危险。今天写小玩具的时候又遇到跨域问题，索性先粗略总结一下跨域的一些方法。
CORS我刚开始学Ajax的时候要写demo练习嘛，所以就用世界上最好的语言php在后端echo一些数据。比如"><meta name="keywords" content="frontend,life"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="renderer" content="webkit"><link rel="short icon" href="/images/favicon.png" type="image/x-icon"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/blog_basic.css"><link rel="stylesheet" href="/css/font-awesome.min.css"><link rel="alternate" type="application/atom+xml" title="ATOM 1.0" href="/atom.xml"></head><body><div class="sidebar animated fadeInDown"><div class="logo-title"><div class="title"><img src="/images/logo@2x.png" style="width:127px;"><h3 title=""><a href="/">北方公园</a></h3><div class="description"><p>痛苦如此持久，像蜗牛充满耐心地移动；快乐如此短暂，像兔子的尾巴掠过秋天的草原</p></div></div></div><ul class="social-links"><li><a href="http://github.com/hunnble"><i class="fa fa-github"></i></a></li></ul><div class="footer"><a target="_blank" href="/"><span>Theme by </span></a><a href="https://www.caicai.me"> CaiCai </a><span>&</span><a href="https://github.com/Ben02/hexo-theme-Anatole"> Ben</a><div class="by_farbox"><a href="https://hexo.io/zh-cn/" target="_blank">Proudly published with Hexo&#65281;</a></div></div></div><div class="main"><div class="page-top animated fadeInDown"><div class="nav"><li><a href="/">首页</a></li><li><a href="/archives">归档</a></li></div><div class="information"><div class="back_btn"><li><a onclick="window.history.go(-1)" class="fa fa-chevron-left"></a></li></div></div></div><div class="autopagerize_page_element"><div class="content"><div class="post-page"><div class="post animated fadeInDown"><div class="post-title"><h3><a>几种跨域的方法</a></h3></div><div class="post-content"><p>谈到前端肯定少不了Ajax,谈到Ajax肯定少不了跨域。诗兴大发的我很想说一句，哦，跨域，你就像毒蛇一样，美丽而又危险。<br>今天写小玩具的时候又遇到跨域问题，索性先粗略总结一下跨域的一些方法。<br><a id="more"></a></p>
<h3 id="CORS"><a href="#CORS" class="headerlink" title="CORS"></a>CORS</h3><p>我刚开始学Ajax的时候要写demo练习嘛，所以就用世界上最好的语言php在后端echo一些数据。比如这样的：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;?php</span></div><div class="line">header(<span class="string">"Access-Control-Allow-Origin:./js/create_data.js"</span>);</div><div class="line">$test_obj1 = <span class="keyword">array</span> (</div><div class="line">    <span class="string">'rank'</span>=&gt; <span class="number">2</span>,</div><div class="line">    <span class="string">'title'</span>=&gt; <span class="string">"测试一, data类型为数组"</span>,</div><div class="line">    <span class="string">'describe'</span>=&gt; <span class="string">"subheading1"</span>,</div><div class="line">    <span class="string">'data'</span>=&gt; <span class="keyword">Array</span>(<span class="string">"aaaaaaaaaaaaa"</span>, <span class="string">"bbbbbbbbbbbbbb"</span>, <span class="string">"ccccccccccc"</span>)</div><div class="line">);</div><div class="line">$test_obj2 = <span class="keyword">array</span> (</div><div class="line">    <span class="string">'rank'</span>=&gt; <span class="number">4</span>,</div><div class="line">    <span class="string">'title'</span>=&gt; <span class="string">"测试二, data类型为键值对(对象)"</span>,</div><div class="line">    <span class="string">'describe'</span>=&gt; <span class="string">"subheading2"</span>,</div><div class="line">    <span class="string">'data'</span>=&gt; <span class="keyword">array</span>(</div><div class="line">        <span class="string">"aaa"</span>=&gt; <span class="string">"aaaaaa"</span>,</div><div class="line">        <span class="string">"bbb"</span>=&gt; <span class="string">"bbbbbbbbb"</span></div><div class="line">    )</div><div class="line">);</div><div class="line">$test_obj3 = <span class="keyword">array</span> (</div><div class="line">    <span class="string">'rank'</span>=&gt; <span class="number">5</span>,</div><div class="line">    <span class="string">'title'</span>=&gt; <span class="string">"测试三, data类型为字符串(暂时不进行trim和过滤特殊字符操作)"</span>,</div><div class="line">    <span class="string">'describe'</span>=&gt; <span class="string">"subheading3"</span>,</div><div class="line">    <span class="string">'data'</span>=&gt; <span class="string">"cccccccc！！！"</span></div><div class="line">);</div><div class="line">$test_obj4 = <span class="keyword">array</span> (</div><div class="line">    <span class="string">'rank'</span>=&gt; <span class="number">5</span>,</div><div class="line">    <span class="string">'title'</span>=&gt; <span class="string">"测试四, data类型为含有对象的数组"</span>,</div><div class="line">    <span class="string">'describe'</span>=&gt; <span class="string">"subheading4"</span>,</div><div class="line">    <span class="string">'data'</span>=&gt; <span class="keyword">Array</span>(<span class="string">"data1"</span>, <span class="keyword">array</span>(<span class="string">"data2"</span>=&gt; <span class="string">"data2value"</span>), <span class="string">"data3"</span>)</div><div class="line">);</div><div class="line">$test_obj5 = <span class="keyword">array</span> (</div><div class="line">    <span class="string">'rank'</span>=&gt; <span class="number">5</span>,</div><div class="line">    <span class="string">'title'</span>=&gt; <span class="string">"测试五 data类型为含有数组的对象"</span>,</div><div class="line">    <span class="string">'describe'</span>=&gt; <span class="string">"subheading5"</span>,</div><div class="line">    <span class="string">'data'</span>=&gt; <span class="keyword">array</span>(</div><div class="line">        <span class="string">'data1'</span>=&gt; <span class="string">"data1value"</span>,</div><div class="line">        <span class="string">'data2'</span>=&gt; <span class="keyword">Array</span>(<span class="string">"data2"</span>, <span class="string">"data3"</span>)</div><div class="line">    )</div><div class="line">);</div><div class="line"></div><div class="line"><span class="keyword">echo</span> json_encode(<span class="keyword">Array</span>($test_obj1, $test_obj2, $test_obj3, $test_obj4, $test_obj5));</div><div class="line"><span class="meta">?&gt;</span></div></pre></td></tr></table></figure></p>
<p>第一次写的时候没有加第二行的那个添加http头的语句，在运行的时候就报错，因为我当时测试当然是在本地，本地不同文件夹不在同一域内，这就形成了跨域。<br>而聪明的我机智地找到了破解之法，那就是给php手动设置Access-Control-Allow-Origin，允许我前端的文件去访问，再次在前端get，成功得到数据。这种方法叫做CORS（跨域资源共享，Cross-Origin Resource Sharing），这种方法比较方便，浏览器的兼容性也不错，被广泛运用在移动端。<br>但是不能满足于此，比如今天我遇到的问题是要用豆瓣的读书API，总不能给豆瓣API小组打电话说：“嗨，给我加一行代码吧我跨域了解决不了了在线等挺急的。”吧。所以说打铁还需自身硬（这句话怎么怪怪的），一定有别的方法可以（在一定程度上）直接解决跨域问题。</p>
<h3 id="JSONP"><a href="#JSONP" class="headerlink" title="JSONP"></a>JSONP</h3><p>JSONP吧，这个方法很强大滴。<br>今天想玩玩豆瓣API，给自己正在用express做的一个书单（叫图书管理系统总是有种浓浓的大作业风）应用加点内容，然后去<a href="https://developers.douban.com/wiki/?title=book_v2" target="_blank" rel="external">豆瓣API文档</a>看了看就开始写了。为了简洁还是用上了jQuery，今天试的是根据图书名来获取图书信息。<br>路由：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">router.get(<span class="string">'/book/:name/:author'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</div><div class="line">  book.get(req.params.name, req.params.author, <span class="function"><span class="keyword">function</span> (<span class="params">err, _book</span>) </span>&#123;</div><div class="line">    <span class="keyword">if</span> (!_book) &#123;</div><div class="line">      req.flash(<span class="string">'error'</span>, <span class="string">'获取书籍信息失败'</span>);</div><div class="line">      <span class="keyword">return</span> res.redirect(<span class="string">'/'</span>);</div><div class="line">    &#125;</div><div class="line">    res.render(<span class="string">'book'</span>, &#123;</div><div class="line">      <span class="attr">title</span>: _book.name,</div><div class="line">      <span class="attr">user</span>: req.session.user,</div><div class="line">      <span class="attr">success</span>: req.flash(<span class="string">'success'</span>).toString(),</div><div class="line">      <span class="attr">error</span>: req.flash(<span class="string">'error'</span>).toString()</div><div class="line">    &#125;);</div><div class="line">  &#125;);</div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<p>这段代码用不着读懂，因为有我自己在别处定义的方法，大概的功能就是先去数据库里找有没有添加过name是参数name的书，有的话就渲染ejs模版book.ejs。重点在下面。<br>不在后端调用API而放在前端用Ajax是因为Ajax是随时想再获取就可以立刻获取嘛比如到时候用户向下浏览到底的时候就可以动态再加载一些数据，写在后端就要refresh整个页面了相当，Ajax的优势就体现在这儿了。<br>前端的处理我使用了JSONP，先讲原理然后放上代码就不用解释了，哈哈。<br>JSONP是JSON with padding（填充式JSON）的简写，意思就是被包裹在函数中的json：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">callback (&#123;<span class="string">'name'</span>: <span class="string">'Tyrion'</span>&#125;);</div></pre></td></tr></table></figure></p>
<p>JSONP由两部分组成：回调函数和数据。回调函数是当响应到来时应该在页面中调用的函数。回调函数的网名字一般在请求中指定。数据则是传入回调函数中的JSON。<br>JSONP的实现是动态添加一个script标签，它是可以跨域的，给它的src属性指定为要访问的url即可。<br>在jQuery中，使用JSONP十分方便，只需要在ajax方法中改动几处。接着上面的代码来看我的实现：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line">  * 调用豆瓣搜索书API并解析获取的json数据，动态渲染页面。</div><div class="line">  */</div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">getBook</span> (<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="keyword">var</span> name = <span class="built_in">window</span>.location.pathname.split(<span class="string">'/'</span>)[<span class="number">2</span>];</div><div class="line"></div><div class="line">    $.ajax(&#123;</div><div class="line">        <span class="attr">type</span>: <span class="string">'GET'</span>,</div><div class="line">        <span class="attr">url</span>: <span class="string">'https://api.douban.com/v2/book/search?q='</span> + name,</div><div class="line">        <span class="attr">dataType</span>: <span class="string">'jsonp'</span>,</div><div class="line">        <span class="attr">jsonp</span>: <span class="string">'callback'</span>,</div><div class="line">        <span class="attr">success</span>: <span class="function"><span class="keyword">function</span> (<span class="params">result</span>) </span>&#123;</div><div class="line">            <span class="comment">// result就是豆瓣返回的json数据了。下面就可以使用数据来做事情...</span></div><div class="line">        &#125;</div><div class="line">    &#125;);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>name是从页面的url中取的name参数。<br>注意将数据类型指定为’jsonp’和指定jsonp: ‘callback’。</p>
<h3 id="img-Ping"><a href="#img-Ping" class="headerlink" title="img Ping"></a>img Ping</h3><p>这个没什么好说的啦，原理就是动态加一个img标签，跟JSONP一个道理。但是和script不同，img无法对响应文本进行处理，所以只能用于get。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> img = <span class="keyword">new</span> Image();</div><div class="line">img.onload = img.onerror = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="comment">// Done</span></div><div class="line">&#125;;</div><div class="line">img.src = <span class="string">'http://www.targetUrl.com?name=Tyrion'</span>;</div></pre></td></tr></table></figure></p>
<h3 id="Comet"><a href="#Comet" class="headerlink" title="Comet"></a>Comet</h3><p>名字起的不错哈哈哈，<del>反正自从我用过celery后其它的框架啊库啊还有技术名词我都觉得挺好的</del><br>Comet在这个语境下指的是服务器推送，是服务器段向客户端推送数据的技术。<br>有两种实现Comet的方式：长轮询和流，根据名字应该已经能知道它们的实现方式了。这个我还没有用过，就不不懂装懂了。</p>
<h3 id="Web-Sockets"><a href="#Web-Sockets" class="headerlink" title="Web Sockets"></a>Web Sockets</h3><p>这个技术似乎被评价得很高，它是一个新浏览器API，可以现在浏览器和服务器之间提供一个单独而持久的连接，是基于HTTP而升级成的网Web Socket协议的连接。所以服务器需要是支持这个协议的。<br>Web Sockets提供一套API来实现，过段时间我学完会回来填坑的。</p>
<h3 id="结尾"><a href="#结尾" class="headerlink" title="结尾"></a>结尾</h3><p>放假回来一周了，每天晚上一点多都要习惯性地看一下电脑的电量然后看到是百分之百就会愣一下。同时看几本书所以导致一周下来都没有看到一半以上的所以潜意识里有点消沉，但是又都想看，但愿下周能看完最薄的一本哈哈哈。<br>好久没写css了再写的时候用LESS玩玩吧，感觉文档也不多，也有用过scss所以应该会很容易上手吧哈哈哈，也不知道它的媒体查询那块简洁不简洁。</p>
</div><div class="post-footer"><div class="meta"><div class="info"><i class="fa fa-sun-o"></i><span class="date">2016-07-11</span><i class="fa fa-tag"></i><a href="/tag/前端/" title="前端" class="tag">前端 </a></div></div></div></div><div class="share"><div class="evernote"><a href="javascript:(function(){EN_CLIP_HOST='http://www.evernote.com';try{var%20x=document.createElement('SCRIPT');x.type='text/javascript';x.src=EN_CLIP_HOST+'/public/bookmarkClipper.js?'+(new%20Date().getTime()/100000);document.getElementsByTagName('head')[0].appendChild(x);}catch(e){location.href=EN_CLIP_HOST+'/clip.action?url='+encodeURIComponent(location.href)+'&amp;title='+encodeURIComponent(document.title);}})();" ref="nofollow" target="_blank" class="fa fa-bookmark"></a></div><div class="weibo"><a href="javascript:void((function(s,d,e){try{}catch(e){}var f='http://service.weibo.com/share/share.php?',u=d.location.href,p=['url=',e(u),'&amp;title=',e(d.title),'&amp;appkey=2924220432'].join('');function a(){if(!window.open([f,p].join(''),'mb',['toolbar=0,status=0,resizable=1,width=620,height=450,left=',(s.width-620)/2,',top=',(s.height-450)/2].join('')))u.href=[f,p].join('');};if(/Firefox/.test(navigator.userAgent)){setTimeout(a,0)}else{a()}})(screen,document,encodeURIComponent));" class="fa fa-weibo"></a></div><div class="twitter"><a href="http://twitter.com/home?status=,http://hunnble.github.io/2016/07/11/几种跨域的方法/,北方公园,几种跨域的方法,;" class="fa fa-twitter"></a></div></div><div class="pagination"><ul class="clearfix"><li class="pre pagbuttons"><a role="navigation" href="/2016/07/21/身份证号匹配正则/" title="身份证号匹配正则" class="btn">上一篇</a></li><li class="next pagbuttons"><a role="navigation" href="/2016/07/05/ES6-函数的扩展/" title="ES6-函数的扩展" class="btn">下一篇</a></li></ul></div></div></div></div></div><script src="/js/jquery.js"></script><script src="/js/jquery-migrate-1.2.1.min.js"></script><script src="/js/jquery.appear.js"></script></body></html>