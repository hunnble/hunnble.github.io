
<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<link rel="alternate" href="/atom.xml" type="application/atom+xml">
<title>React-事件 [ 北方公园 ]</title>
<meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
<meta name="viewport" content="width=device-width,initial-scale=1">
<link rel="shortcut icon" href="/images/favicon.ico">
<link rel="stylesheet" href="/css/default_highlight.min.css">
<link rel="stylesheet" href="/libs/fancybox/source/jquery.fancybox.css" type="text/css" media="screen">
<link rel="stylesheet" href="/css/main.css">
</head>
<body>
<div class="navbar-fixed white-text">
<nav class="transparent z-depth-0">
<div class="nav-wrapper">
<ul id="nav-mobile" class="right hide-on-med-and-down">
<li>
<a class="waves-effect text-lighten-4" href="/">主页</a>
</li>
<li>
<a class="waves-effect text-lighten-4" href="/archive">归档</a>
</li>
<li>
<a class="waves-effect text-lighten-4" href="/about">关于</a>
</li>
</ul>
<a href="#" data-activates="slide-nav" class="button-collapse text-lighten-4" id="side-nav-switcher"><i class="material-icons">menu</i></a>
</div>
</nav>
</div>
<ul id="slide-nav" class="side-nav">
<li>
<div class="userView lighten-2 teal">
<div class="background">
<h5 class="white-text inline-title">Noski</h5>
</div>
<img class="circle" src="/images/avatar.png">
<h5 class="white-text inline-title">北方公园</h5>
<br>
<h5 class="white-text inline-title">Web/书和思考/一派胡言</h5>
</div>
</li>
<li><a class="waves-effect lighten-2 teal-text" href="/">主页</a></li>
<li><a class="waves-effect lighten-2 teal-text" href="/archive">归档</a></li>
<li><a class="waves-effect lighten-2 teal-text" href="/about">关于</a></li>
</ul>
<div class="parallax-container valign-wrapper hide-on-small-only" style="height:400px">
<div class="parallax lighten-2 teal">
<img src="/images/background.jpg">
</div>
<script type="text/javascript">var container=document.querySelector(".parallax-container"),tmpTitle=container.querySelector(".hide-on-image-load"),img=container.querySelector("img");img.onload=function(){tmpTitle&&(tmpTitle.style.display="none")}</script>
</div>
<main id="container-outer" class="">
<div class="row">
<div class="col s12 m10 push-m1 l8 push-l2" id="container-inner">
<section id="post" class="card article z-depth-0">
<div class="card-panel z-depth-0 black-text">
<h1>React-事件</h1>
<div class="valign-wrapper blue-grey-text">
<i class="material-icons valign">query_builder</i>&nbsp
<time datetime="2016-05-05T10:37:51.000Z" class="valign">
2016 5月 5日 晚上6:37:51
</time>
</div>
<div class="valign-wrapper sm-text blue-grey-text">
<i class="material-icons valign">grade</i>&nbsp
<span id="busuanzi_container_page_pv" class="valign">
阅读<span id="busuanzi_value_page_pv"></span>次
</span>
</div>
<div class="section right">
<span class="new badge amber left" data-badge-caption="">
<a href="/tag/前端/" title="#前端" class="white-text" target="_blank" rel="external">#前端</a>
</span>
<span class="new badge green left" data-badge-caption="">
<a href="/tag/React/" title="#React" class="white-text" target="_blank" rel="external">#React</a>
</span>
</div>
</div>
<div class="card-content z-depth-0">
<p>React的事件处理机制对前端程序员来说很容易掌握。<br><a id="more"></a></p>
<h3 id="绑定事件"><a href="#绑定事件" class="headerlink" title="绑定事件"></a>绑定事件</h3><p>React通过将事件处理器绑定到组件上来处理事件。在事件被触发时，更新组件内部状态。在命名方面，和原生的JavaScript基本一致。绑定事件处理器的方法如下：<br></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> VoteBar = React.createClass(&#123;</div><div class="line">    <span class="attr">getInitialState</span>: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="keyword">return</span> &#123;</div><div class="line">            <span class="attr">voteCount</span>: <span class="keyword">this</span>.props.voteCount</div><div class="line">        &#125;</div><div class="line">    &#125;,</div><div class="line">    <span class="attr">getVote</span>: <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</div><div class="line">        e.preventDefault();</div><div class="line">        <span class="keyword">this</span>.props.onVote(<span class="keyword">this</span>.props.voteKey, <span class="keyword">this</span>.state.voteCount + <span class="number">1</span>);</div><div class="line">        <span class="keyword">this</span>.setState(&#123;</div><div class="line">            <span class="attr">voteCount</span>: <span class="keyword">this</span>.state.voteCount + <span class="number">1</span></div><div class="line">        &#125;);</div><div class="line">    &#125;,</div><div class="line">    <span class="attr">getDis</span>: <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</div><div class="line">        e.preventDefault();</div><div class="line">        <span class="keyword">this</span>.props.onVote(<span class="keyword">this</span>.props.voteKey, <span class="keyword">this</span>.state.voteCount - <span class="number">1</span>);</div><div class="line">        <span class="keyword">this</span>.setState(&#123;</div><div class="line">            <span class="attr">voteCount</span>: <span class="keyword">this</span>.state.voteCount - <span class="number">1</span></div><div class="line">        &#125;);</div><div class="line">        <span class="keyword">this</span>.refs.agree.getDOMNode().innerHTML = <span class="keyword">this</span>.state.voteCount;</div><div class="line">    &#125;,</div><div class="line">    <span class="attr">render</span>: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="keyword">return</span> (</div><div class="line">            <span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">"voteBar"</span>&gt;</span></span></div><div class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">"vote"</span> <span class="attr">ref</span>=<span class="string">"agree"</span> <span class="attr">onClick</span>=<span class="string">&#123;this.getVote&#125;</span>&gt;</span>&#123;this.state.voteCount&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">"dis"</span> <span class="attr">onClick</span>=<span class="string">&#123;this.getDis&#125;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">        )</div><div class="line">    &#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure><p></p>
<p>还是以投票组件为例，onClick绑定点击事件，处理函数是this.getVote和this.getDis<br>不过，虽然这种写法类似于HTML中内联事件处理器，但是React的底层实现并不是使用HTML的内联事件处理器(而是事件代理机制)。所以是没有内联事件处理器的弊端的。<br>而不使用JSX的写法大概是这样:<br></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">React.DOM.button(&#123;<span class="attr">onClick</span>: <span class="keyword">this</span>.handleClick&#125;, <span class="string">'点击我'</span>);</div></pre></td></tr></table></figure><p></p>
<h3 id="事件对象"><a href="#事件对象" class="headerlink" title="事件对象"></a>事件对象</h3><p>在用户向input、textarea等输入时必须在每次输入时更改state，否则内容就无法顺利地改变了。那么如何获取change事件或者其他事件呢？可以使用事件对象，也就是我们熟悉的event。通过获取event.target.value，然后更新state。下面看这个onChange的具体实现:<br></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> InputAnwser = React.createClass(&#123;</div><div class="line">    <span class="attr">getInitialState</span>: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="keyword">return</span> &#123;</div><div class="line">            <span class="attr">title</span>: <span class="string">""</span>,</div><div class="line">            <span class="attr">anwser</span>: <span class="string">""</span></div><div class="line">        &#125;</div><div class="line">    &#125;,</div><div class="line">    <span class="attr">editTitle</span>: <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</div><div class="line">        <span class="keyword">this</span>.setState(&#123;</div><div class="line">            <span class="attr">title</span>: e.target.value</div><div class="line">        &#125;);</div><div class="line">    &#125;,</div><div class="line">    <span class="attr">editAnwser</span>: <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</div><div class="line">        <span class="keyword">this</span>.setState(&#123;</div><div class="line">            <span class="attr">anwser</span>: e.target.value</div><div class="line">        &#125;);</div><div class="line">    &#125;,</div><div class="line">    <span class="attr">addQuestion</span>: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="keyword">if</span>(!<span class="keyword">this</span>.refs.title.getDOMNode().value) &#123;</div><div class="line">            <span class="keyword">this</span>.props.onToggle();</div><div class="line">            <span class="keyword">return</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">var</span> nq = &#123;</div><div class="line">            <span class="attr">title</span>: <span class="keyword">this</span>.refs.title.getDOMNode().value,</div><div class="line">            <span class="attr">description</span>: <span class="keyword">this</span>.refs.description.getDOMNode().value,</div><div class="line">            <span class="attr">voteCount</span>: <span class="number">0</span></div><div class="line">        &#125;;</div><div class="line">        <span class="keyword">this</span>.props.onAddQuestion(nq);</div><div class="line">        <span class="keyword">this</span>.props.onToggle();</div><div class="line">    &#125;,</div><div class="line">    <span class="attr">clear</span>: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="keyword">this</span>.refs.title.getDOMNode().value = <span class="string">""</span>;</div><div class="line">        <span class="keyword">this</span>.refs.description.getDOMNode().value = <span class="string">""</span>;</div><div class="line">    &#125;,</div><div class="line">    <span class="attr">render</span>: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> displayObj = &#123;</div><div class="line">            <span class="attr">display</span>: <span class="keyword">this</span>.props.isDisplayed ? <span class="string">"block"</span> : <span class="string">"none"</span></div><div class="line">        &#125;;</div><div class="line">        <span class="keyword">return</span> (</div><div class="line">            <span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"inputBar"</span> <span class="attr">style</span>=<span class="string">&#123;displayObj&#125;</span>&gt;</span></span></div><div class="line">                <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">ref</span>=<span class="string">"title"</span> <span class="attr">className</span>=<span class="string">"inputtitle"</span> <span class="attr">onChange</span>=<span class="string">&#123;this.editTitle&#125;</span> <span class="attr">placeholder</span>=<span class="string">"输入问题描述"</span> /&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">textarea</span> <span class="attr">ref</span>=<span class="string">"description"</span> <span class="attr">className</span>=<span class="string">"inputanwser"</span> <span class="attr">onChange</span>=<span class="string">&#123;this.editAnwser&#125;</span> <span class="attr">placeholder</span>=<span class="string">"输入问题"</span>&gt;</span><span class="tag">&lt;/<span class="name">textarea</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">button</span> <span class="attr">className</span>=<span class="string">"btn cancelBtn"</span> <span class="attr">onClick</span>=<span class="string">&#123;this.props.onToggle&#125;</span>&gt;</span>取消<span class="tag">&lt;/<span class="name">button</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">button</span> <span class="attr">className</span>=<span class="string">"btn submitBtn"</span> <span class="attr">onClick</span>=<span class="string">&#123;this.addQuestion&#125;</span>&gt;</span>提交回答<span class="tag">&lt;/<span class="name">button</span>&gt;</span></div><div class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">        );</div><div class="line">    &#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure><p></p>
<p>两个可输入标签的onChange分别绑定editTitle和editAnwser，这两个函数分别更新state中的title和anwser，实现由事件对组件的更新。</p>
<h3 id="其它要注意的地方"><a href="#其它要注意的地方" class="headerlink" title="其它要注意的地方"></a>其它要注意的地方</h3><ul>
<li>触控(Touch)系事件需要手动启用: React.initializeTouchEvents(true);</li>
<li>获取浏览器事件对象的方法是nativeEvent</li>
</ul>
<div class="sibling-post center-align card-panel z-depth-0 section">
<a href="/2016/05/04/React-数据流/" class="btn-flat blue-grey-text right">
<i class="material-icons right">chevron_right</i>
React-数据流
</a>
<a href="/2016/05/05/React-mixin/" class="btn-flat blue-grey-text left">
<i class="material-icons left">chevron_left</i>
React-mixin
</a>
</div>
<div class="comment" id="duoshuo">
<div class="ds-thread" data-thread-key="post-React-事件" data-title="React-事件" data-url="http://hunnble.github.io/2016/05/05/React-事件/"></div>
<script type="text/javascript">var duoshuoQuery={short_name:"hunnble"},ds=document.createElement("script");ds.type="text/javascript",ds.async=!0,ds.src=("https:"==document.location.protocol?"https:":"http:")+"//static.duoshuo.com/embed.js",ds.charset="UTF-8",(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(ds)</script>
</div>
</div>
</section>
<div class="fixed-action-btn click-to-toggle">
<a class="btn-floating btn-large lighten-2 teal">
<i class="large material-icons">view_module</i>
</a>
<ul>
<li>
<a id="back-to-top" class="btn-floating lighten-2 teal waves-effect %>" href="#">
<i class="material-icons">navigation</i>
</a>
</li>
</ul>
</div>
</div>
<aside class="col m2 push-m2 hide-on-med-and-down">
<div class="toc transparent card-panel z-depth-0">
<ol class="table-of-contents"><li class="table-of-contents-item table-of-contents-level-3"><a class="table-of-contents-link" href="#绑定事件"><span class="table-of-contents-text">绑定事件</span></a></li><li class="table-of-contents-item table-of-contents-level-3"><a class="table-of-contents-link" href="#事件对象"><span class="table-of-contents-text">事件对象</span></a></li><li class="table-of-contents-item table-of-contents-level-3"><a class="table-of-contents-link" href="#其它要注意的地方"><span class="table-of-contents-text">其它要注意的地方</span></a></li></ol>
</div>
</aside>
</div>
</main>
<footer class="page-footer lighten-2 teal">
<div class="container section">
<div class="center-align white-text text-lighten-4">
<p>
Powerd by <a href="https://hexo.io/zh-cn/" title="hexo" target="_blank" rel="external">hexo</a>. Theme by <a href="https://github.com/hunnble/hexo-theme-immortal" title="immortal" target="_blank" rel="external">immortal</a>.
</p>
<h5>
总访问量&nbsp;<span id="busuanzi_value_site_pv"></span>
总访客数&nbsp;<span id="busuanzi_value_site_uv"></span>
</h5>
</div>
</div>
<div class="footer-copyright center-align">
Copyright © 2016 Noski
</div>
</footer>
<script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<script src="/js/highlight.min.js"></script>
<script type="text/javascript" src="https://cdn.staticfile.org/jquery/2.1.1/jquery.min.js"></script>
<script type="text/javascript" src="https://cdn.staticfile.org/materialize/0.97.8/js/materialize.min.js"></script>
<script type="text/javascript" src="/libs/fancybox/source/jquery.fancybox.pack.js"></script>
<script type="text/javascript" src="/js/main.js"></script>
</body>
</html>
